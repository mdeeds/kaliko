import * as THREE from "three";
import { BoxBufferGeometry, IcosahedronBufferGeometry, MeshPhongMaterial } from "three";
import { Palette } from "./palette";

export class WorldMap extends THREE.Object3D {

  private map: string[] = [
    "1234567890123456789012345678901234567890123456789012345678901",
    "2............................................................",
    "3............................................................",
    "4............................................................",
    "5............................................................",
    "6............................................................",
    "7............................................................",
    "8............................................................",
    "9............................................................",
    "0............................................................",
    "1............................................................",
    "2............................................................",
    "3............................................................",
    "4............................................................",
    "5............................................................",
    "6............................................................",
    "7............................................................",
    "8............................................................",
    "9............................................................",
    "10...........................................................",
    "11...........................0123456789876543210.............",
    "12...........................................................",
    "13...........................................................",
    "14...........................................................",
    "15...........................................................",
    "16...........................................................",
    "17...........................................................",
    "18...........................................................",
    "19...........................................................",
    "20...........................................................",
    "21...........................................................",
    "22...........................................................",
    "23...........................................................",
    "24...........................................................",
    "25...........................................................",
    "26...........................................................",
    "27...........................................................",
    "28...........................................................",
    "29...........................................................",
    "30...........................................................",
    "31...........................................................",
    "32...........................................................",
    "33...........................................................",
    "34...........................................................",
    "35...........................................................",
    "36...........................................................",
    "37...........................................................",
    "38...........................................................",
    "39...........................................................",
    "40...........................................................",
    "41...........................................................",
    "42...........................................................",
    "43...........................................................",
    "44...........................................................",
    "45...........................................................",
    "46...........................................................",
    "47...........................................................",
    "48...........................................................",
    "49...........................................................",
    "50...........................................................",
    "51...........................................................",
    "52...........................................................",
    "53...........................................................",
    "54...........................................................",
    "55...........................................................",
    "56...........................................................",
    "57...........................................................",
    "58...........................................................",
    "59...........................................................",
    "50...........................................................",
    "61...........................................................",
  ];

  private box(height: number): THREE.Object3D {
    const boxHeight = height * 5 + 0.5;
    const b = new THREE.Mesh(
      new BoxBufferGeometry(5, boxHeight, 5),
      new MeshPhongMaterial({ color: this.p.in(new THREE.Color('#ef4')) })
    );
    b.position.y = boxHeight / 2;
    return b;
  }

  constructor(private p: Palette) {
    super();

    let z = -5 * 30;
    for (const l of this.map) {
      let x = -5 * 30;
      for (const c of l) {
        let o: THREE.Object3D = null;
        switch (c) {
          case '.':
            o = new THREE.Mesh(
              new IcosahedronBufferGeometry(0.5, 2),
              new MeshPhongMaterial({ color: p.in(new THREE.Color('#888')) })
            );
            o.position.y = 0.25;
            break;
          case '0': o = this.box(0); break;
          case '1': o = this.box(1); break;
          case '2': o = this.box(2); break;
          case '3': o = this.box(3); break;
          case '4': o = this.box(4); break;
          case '5': o = this.box(5); break;
          case '6': o = this.box(6); break;
          case '7': o = this.box(7); break;
          case '8': o = this.box(8); break;
          case '9': o = this.box(9); break;
        }
        if (o) {
          o.position.x = x;
          o.position.z = z;
          this.add(o);
        }
        x += 5;
      }
      z += 5;
    }
  }
}